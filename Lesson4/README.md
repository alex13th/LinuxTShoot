## Практическое задание 4

### 1. (Выполнено) Научиться пользоваться утилитой tcpdump (сохранить дамп данных в файл, открыть потом при помощи wireshark)

**Файл дампа**: <a href="tcpdump.cap">tcpdump.cap</a>

### 2. (Выполнено) Посмотреть все сокеты в состоянии LISTEN при помощи утилиты netstat и ss


**Команда**:
<pre>sudo netstat -tlpn > netstat.txt</pre>

**Вывод на рабочей станции:**
<pre>
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      1540/dnsmasq        
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      967/systemd-resolve 
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1266/cupsd          
tcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      1283/postgres       
tcp        0      0 0.0.0.0:902             0.0.0.0:*               LISTEN      1983/vmware-authdla 
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      1292/mysqld         
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1213/nginx: master  
tcp6       0      0 ::1:631                 :::*                    LISTEN      1266/cupsd          
tcp6       0      0 :::33060                :::*                    LISTEN      1292/mysqld         
tcp6       0      0 :::902                  :::*                    LISTEN      1983/vmware-authdla 
tcp6       0      0 :::80                   :::*                    LISTEN      1213/nginx: master  
</pre>

### 3. Запустить скрипт lab4.sh и прочинить возникшине сетевые проблемы, связанные с невозможностью пропинговать 1.1.1.1
Обратите внимание, что перезапуск network.service, ребут сервера, выключение и включение интерфейса сбрасывает изменения и не является средством починки.

- Проверена сетевая связанность на 2 уровне с другими хостами подсети - проблем не обнаружено (к сожалению, проблему со шлюзом обнаружил позднее);
- Проверена таблица маршрутизации - обнаружен неверный маршрут по умолчанию;
- Удален неверный маршрут по умолчанию.
- Восстановлен маршрут по умолчанию.
- Проверена доступность маршрутизатора на 3 уровне - отсутствует;
- Проверена связанность с маршрутизатором на 2 уровне - обнаржена некорректная запись в arp-таблице;
- Удалена перманентная arp-запись.

\* Описал реальный порядок действий, а не тот который стал понятен после окончательного решения проблемы.


### 4. (Выполнено) Создать статический маршрут на 8.8.8.8/32 через интерфейс lo. Запустить ping на этот адрес


4.1 Добавлен маршрут:
<pre>
ip route add 8.8.8.8/32 dev lo
</pre>

4.2 Запущен пинг:

**Команда:**

<pre>ping 8.8.8.8</pre>

**Результат:**

<pre>
--- 8.8.8.8 ping statistics ---
4 packets transmitted, 0 received, 100% packet loss, time 3008ms
</pre>


### 5. Включить tcpdump и показать в нем отправленные icmp запросы на 8.8.8.8


**Команда:**
<pre>tcpdump -tuna -i lo</pre>


**Результат:**
<pre>
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 1, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 2, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 3, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 4, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 5, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 6, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 7, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 8, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 9, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 10, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1491, seq 11, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1494, seq 1, length 64
00:00:00:00:00:00 > 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: 192.168.124.139 > 8.8.8.8: ICMP echo request, id 1494, seq 2, length 64
</pre>