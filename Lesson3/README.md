## Практическое задание 3

### 1. (Выполнено) Добавьте в операционную систему еще один жесткий диск размером не менее 2Gb (ожидается, что это будет sdb)
### 2. (Выполнено) Скачайте скрипты и запускайте из будучи пользователем root
### 3. (Выполнено) Не смотрите содержимое файла, иначе чинить будет не так интенесно
### 4. (Выполнено) Загрузите интересующий вас скрипт на вашу виртуалку с linux (scp или winscp вам в помощь)
### 5. (Выполнено) Сделайте файл исполняемым (~# chmod +x <script_name>)
### 6. (Выполнено) Запустите файл lab1.sh и почините возникшую проблему

#### Решение:

1. Произведена загрузка с загрузочного диска
2. Восстановлена MBR

<pre>
chroot /mnt/sysimage 
grub2-install /dev/sda
</pre>

P.S. Похоже в скрипте есть ошибка с ребутом.

### 7. Запустите файл lab2.sh и он создаст вам 2 раздела на диске sdb (sdb1 sdb2)
### 8. Перезагрузите виртуальную машину
### 9. Попробуйте примонитровать /dev/sdb1 в директорию /testlab1 (форматировать (запускать mkfs) /dev/sdb1 нельзя)

#### Решение:

Все работы проводяться с блочным устройством /dev/sdb.

1. Удалены все разделы.
2. Создан один раздел размером во все блочное устройство;
3. Отремонтирована файловая система;

<pre>
fsck /dev/sdb1
</pre>

4. Примонтировано устройство /dev/sdb1;

<pre>
mount /dev/sdb1 /testlab1
</pre>

5. Определен размер файловой системы - 475MB:

<pre>
df -T -B M /dev/sdb
</pre>

6. Отмонтирован раздел;

<pre>
umount /testlab1
</pre>

7. Переразбито блочное устройство - размер первого раздела установлен в 475MB.
8. Примонтировано устройство /dev/sdb1 (mount /dev/sdb1 /testlab1).

### 10.  (Выполнено) После того, как вы все починили, перезагрузите операционную систему и запустите скрипт lab3.sh, который создаст вам LVM на диске sdb и сломает его потом. Внимательно читайте вывод скрипта, так как запустить его придется дважны. Один раз он перезагрузит виртуалку сам, второй раз перезагрузить должны вы
### 11.  (Выполнено) Почините возникшую после перезагрузки проблему. Вам может помочь директория /etc/lvm/archive и команда vgcfgrestore -l (посмотрите что она делает и как ей пользоваться).


#### Решение:

1. Просмотрел лог резервных копий конфигураций LVM:

<pre>
  #vgcfgrestore -l vgdata

  File:		/etc/lvm/archive/vgdata_00000-848015187.vg
  Couldn't find device with uuid 12qRcJ-FtgD-Q3xz-o0jF-28uR-uNV3-XIMh5N.
  VG name:    	vgdata
  Description:	Created *before* executing 'vgcreate vgdata /dev/sdb2'
  Backup Time:	Mon Nov  9 00:27:01 2020

   
  File:		/etc/lvm/archive/vgdata_00001-414072322.vg
  VG name:    	vgdata
  Description:	Created *before* executing 'lvcreate -L 500M -n lvdata vgdata'
  Backup Time:	Mon Nov  9 00:27:01 2020

   
  File:		/etc/lvm/archive/vgdata_00002-1042066854.vg
  VG name:    	vgdata
  Description:	Created *before* executing 'lvresize -L -100M /dev/vgdata/lvdata -f -n'
  Backup Time:	Mon Nov  9 00:27:01 2020

   
  File:		/etc/lvm/backup/vgdata
  VG name:    	vgdata
  Description:	Created *after* executing 'lvresize -L -100M /dev/vgdata/lvdata -f -n'
  Backup Time:	Mon Nov  9 00:27:01 2020
   
</pre>

2. Восстановлена конфигурация из файла резервной копии LVM /etc/lvm/archive/vgdata_00002-1042066854.vg:

<pre>
vgcfgrestore -f /etc/lvm/archive/vgdata_00002-1042066854.vg vgdata
</pre>


### 12.  (Выполнено) ****Задание со звездочкой (сломает вам загрузку ОС, вы сможете доломать до конца, что приведет к переустановке). Запустите скрипт lab4.sh. Наслаждайтесь. (Проблема похожа на пункт 10, но то, как вы будете это чинить, отличается)

#### Решение:

1. Через журнал обнаружено, что не монтируется корень файловой системы.
2. Загрузился с дистрибутива.
3. При попытке примонтировать устройства /dev/sda2 выдется ошибка суперблока.
4. В логах dmesg нашел ошибку указывющую на отсутствие конца файловой системы.
5. С помощью утилиты vgdisplay выяснил, что в VG centos имеется 300МБ свободного пространства (отсюда предположение о уменьшении размера LV).
6. Увеличил LV /dev/centos/root на 300МБ.

<pre>
lvextend -L +300M /dev/centos/root
</pre>

7. Проверил монтирование раздела и перезагрузил сервер.


P.S. Описание решения не отражает всей полноты расследования.